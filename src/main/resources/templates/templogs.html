<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{template.html}"
      lang="vi">
<head>
    <title layout:fragment="title">Bảng theo dõi nhiệt độ</title>
</head>
<body>

<div layout:fragment="content">
    <div class="card">
        <div class="card-header">
            <h3 class="text-center card-title">Bảng theo dõi nhiệt độ</h3>
        </div>
        <div class="card-body">
            <div sec:authorize="hasRole('ADMIN')" id="toolbar">
                <button id="delete-button" class="btn btn-danger">Xóa</button>
            </div>
            <table id="table"
                   class="table table-striped table-hover"
                   data-url="/v1/api/templogs?unpaged=true"
                   data-toggle="table"
                   data-auto-refresh="true"
                   data-auto-refresh-interval="60"
                   data-click-to-select="true"
                   data-locale="vi-VN"
                   data-pagination="true"
                   data-search="true"
                   data-show-refresh="true"
                   data-show-toggle="true"
                   data-toolbar="#toolbar"
                   data-show-columns="true"
                   data-mobile-responsive="true"
                   data-check-on-init="true">
                <thead>
                <tr>
                    <th data-field="state" data-checkbox="true"></th>
                    <th data-field="id" data-sortable="true">STT</th>
                    <th data-field="value" data-sortable="true">Giá trị (độ C)</th>
                    <th data-field="createdDate" data-sortable="true" data-formatter="dateFormatter">Cập nhật</th>
                </tr>
                </thead>
            </table>
        </div>
        <div class="card-footer">
        </div>
    </div>
    <script th:src="@{/js/utils.js}"></script>
    <script>
        var $table = $('#table');
        var $deleteButton = $('#delete-button');

        $(function () {
            $deleteButton.click(function () {
                Swal.fire({
                    title: "Xác nhận xóa dữ liệu?",
                    text: "Dữ liệu sau khi xóa sẽ không thể khôi phục!",
                    icon: "warning",
                    showCancelButton: true,
                    cancelButtonText: "Hủy",
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Chắc chắn, xóa!"
                }).then((result) => {
                    if (result.isConfirmed) {
                        var ids = $.map($table.bootstrapTable('getSelections'), function (row) {
                            return row.id;
                        });
                        if (ids.length > 0) {
                            $.ajax({
                                url: '/v1/api/templogs',
                                type: 'DELETE',
                                contentType: 'application/json',
                                data: JSON.stringify(ids),
                                success: function (result) {
                                    $table.bootstrapTable('remove', {
                                        field: 'id',
                                        values: ids
                                    });
                                    Swal.fire({
                                        title: "Đã xóa!",
                                        icon: "success",
                                        toast: true,
                                        position: "top-right",
                                        showConfirmButton: false,
                                        timer: 1500,
                                        timerProgressBar: true
                                    });
                                },
                                error: function (error) {
                                    console.log(error)
                                    Swal.fire({
                                        title: "Lỗi!",
                                        icon: "error",
                                        toast: true,
                                        position: "top-right",
                                        showConfirmButton: false,
                                        timer: 1500,
                                        timerProgressBar: true
                                    });
                                }
                            });
                        } else {
                            Swal.fire({
                                title: "Chưa chọn mục nào!",
                                icon: "error",
                                toast: true,
                                position: "top-right",
                                showConfirmButton: false,
                                timer: 1500,
                                timerProgressBar: true
                            });
                        }
                    }
                });
            });
        });
    </script>
</div>

</body>
</html>